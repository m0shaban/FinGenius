<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        /* ...same base styles as analysis_report.html... */
        .comparison-table {
            margin: 20px 0;
            page-break-inside: avoid;
        }
        .diff-positive { color: green; }
        .diff-negative { color: red; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Financial Comparison Report</h1>
        <p>Comparing {{ files|length }} Files</p>
        <p>Generated on: {{ date.strftime('%Y-%m-%d %H:%M') }}</p>
    </div>

    <div class="section">
        <h2>Files Compared</h2>
        <ul>
            {% for file in files %}
            <li>{{ file.filename }} ({{ file.upload_date.strftime('%Y-%m-%d') }})</li>
            {% endfor %}
        </ul>
    </div>

    {% if summary_stats %}
    <div class="section">
        <h2>Statistical Comparison</h2>
        {% for column, stats in summary_stats.items() %}
        <div class="comparison-table">
            <h3>{{ column }}</h3>
            <table>
                <tr>
                    <th>Metric</th>
                    {% for file in files %}
                    <th>{{ file.filename }}</th>
                    {% endfor %}
                </tr>
                {% for metric in ['mean', 'median', 'std', 'min', 'max'] %}
                <tr>
                    <td>{{ metric|title }}</td>
                    {% for stat in stats %}
                    <td>{{ "%.2f"|format(stat[metric]) }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if differences %}
    <div class="section">
        <h2>Percentage Differences</h2>
        <table>
            <tr>
                <th>Metric</th>
                {% for i in range(1, files|length) %}
                <th>{{ files[i].filename }} vs {{ files[0].filename }}</th>
                {% endfor %}
            </tr>
            {% for column, diffs in differences.items() %}
            <tr>
                <td>{{ column }}</td>
                {% for diff in diffs %}
                <td class="{{ 'diff-positive' if diff > 0 else 'diff-negative' }}">
                    {{ "%.2f"|format(diff) }}%
                    {{ '↑' if diff > 0 else '↓' }}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}

    {% if charts %}
    <div class="section">
        <h2>Visual Comparisons</h2>
        {% for column, chart in charts.items() %}
        <div class="chart-container">
            <h3>{{ column }}</h3>
            <img src="{{ chart }}" alt="Comparison of {{ column }}">
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="footer">
        <p>Generated by FinGenius - AI-Powered Financial Analysis Platform</p>
        <p>Comparison Report - Page 1 of 1</p>
    </div>
</body>
</html>
